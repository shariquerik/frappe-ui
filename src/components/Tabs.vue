<template>
  <TabGroup as="div" class="flex flex-1 flex-col" @change="onTabChange">
    <TabList class="relative flex items-center gap-6 border-b pl-5">
      <Tab
        ref="tabRef"
        as="template"
        v-for="(tab, i) in tabs"
        :key="i"
        v-slot="{ selected }"
      >
        <slot name="tab" v-bind="{ tab, selected }">
          <button
            class="-mb-[1px] flex items-center gap-2 border-b border-transparent py-2.5 text-base text-gray-600 transition-all duration-300 ease-in-out hover:border-gray-400 hover:text-gray-900"
            :class="{ 'text-gray-900': selected }"
          >
            <component v-if="tab.icon" :is="tab.icon" class="h-5" />
            {{ tab.label }}
          </button>
        </slot>
      </Tab>
      <div
        ref="indicator"
        class="absolute -bottom-[1px] h-[1px] w-[82px] bg-gray-900"
        :style="{ left: `${indicatorLeftValue}px` }"
      />
    </TabList>
    <TabPanels class="flex flex-1 overflow-hidden">
      <TabPanel
        class="flex flex-1 flex-col overflow-y-auto"
        v-for="(tab, i) in tabs"
        :key="i"
      >
        <slot v-bind="{ tab }" />
      </TabPanel>
    </TabPanels>
  </TabGroup>
</template>

<script setup>
import { TabGroup, TabList, Tab, TabPanels, TabPanel } from '@headlessui/vue'
import { TransitionPresets, useTransition } from '@vueuse/core'
import { ref, onMounted } from 'vue'

const props = defineProps({
  tabs: [],
})

const tabRef = ref([])
const indicator = ref(null)

let indicatorLeft = ref(0)

const indicatorLeftValue = useTransition(indicatorLeft, {
  duration: 250,
  ease: TransitionPresets.easeOutCubic,
})

function onTabChange(index) {
  const selectedTab = tabRef.value[index].el
  indicator.value.style.width = `${selectedTab.offsetWidth}px`
  indicatorLeft.value = selectedTab.offsetLeft
}

onMounted(() => onTabChange(0))
</script>
